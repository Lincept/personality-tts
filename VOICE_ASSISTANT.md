# 🎙️ 语音助手 Prompt 系统

## 📋 系统设计

### 核心组件

1. **角色设定** - 友好、专业的语音助手
2. **用户信息** - 姓名、偏好、上下文
3. **知识库** - 可添加的背景知识
4. **对话历史** - 自动管理上下文
5. **输出控制** - 专为语音对话优化

## 🎯 Prompt 核心规则

### 1. 输出格式要求

✅ **必须做到**:
- 简洁回答（2-3 句话）
- 口语化表达
- 自然对话风格

❌ **严格禁止**:
- Markdown 格式（`**粗体**`、`### 标题`、`- 列表`）
- 特殊符号（`*`、`#`、`-`、`_`、` ``` `）
- 表情符号（除非用户要求）
- 长篇大论或分点列举

### 2. 对话策略

```
用户：推荐攀岩鞋
❌ 错误：以下是几个推荐：1. La Sportiva 特点：专业性强...
✅ 正确：我推荐 La Sportiva 的 Tarantulace，特别适合初学者。你是刚开始玩攀岩吗？

用户：今天天气怎么样
❌ 错误：根据气象数据显示，今天的天气情况如下：1. 温度...
✅ 正确：今天挺舒服的，15 到 22 度，适合出门。你要出去玩吗？
```

## 🔧 使用方法

### 启动语音助手

```bash
python src/main.py
```

### 基本对话

```
你: 你好
AI: 你好！有什么可以帮你的吗？

你: 今天天气怎么样
AI: 今天挺不错的，适合出门。你要出去玩吗？
```

### 设置用户信息

```
你: /setname 小明
✓ 用户名已设置为: 小明

你: 你好
AI: 你好小明！有什么可以帮你的吗？
```

### 添加知识库

```
你: /addknowledge 用户喜欢攀岩运动
✓ 已添加知识: 用户喜欢攀岩运动

你: 推荐一个周末活动
AI: 既然你喜欢攀岩，周末可以去攀岩馆练习啊！要不要我推荐几个好的攀岩馆？
```

### 查看对话历史

```
你: /history

对话历史:
用户: 你好
助手: 你好！有什么可以帮你的吗？
用户: 今天天气怎么样
助手: 今天挺不错的，适合出门。你要出去玩吗？
```

### 清空历史

```
你: /clear
✓ 对话历史已清空
```

### 查看配置

```
你: /info

当前配置:
  模式: 实时模式 (LLM逐字→TTS→边播边放) ⚡
  TTS: qwen3
  对话轮数: 5
  知识库条目: 3
```

## 📊 Prompt 结构

### 完整的消息构建

```python
messages = [
    {
        'role': 'system',
        'content': '''
你是一个友好、专业的语音助手。

## 核心规则
- 简洁回答：2-3 句话
- 口语化表达
- 禁止 Markdown 格式
- 禁止特殊符号

## 当前时间
2026年1月10日 18:45

## 用户信息
用户名：小明
偏好：喜欢攀岩

## 知识库
1. 用户喜欢攀岩运动
2. 用户周末有空
        '''
    },
    {'role': 'user', 'content': '你好'},
    {'role': 'assistant', 'content': '你好小明！'},
    {'role': 'user', 'content': '推荐周末活动'}
]
```

## 🎨 自定义配置

### 修改角色设定

编辑 `src/voice_assistant_prompt.py`：

```python
def _build_system_prompt(self) -> str:
    return """你是一个 [你的角色设定]。

## 核心规则
[你的规则]
"""
```

### 调整输出长度

```python
# 在 system_prompt 中添加
- 每次回答不超过 50 字
- 如果内容复杂，分多轮对话
```

### 添加特定领域知识

```python
# 在交互模式中
你: /addknowledge 用户是程序员
你: /addknowledge 用户使用 Python
你: /addknowledge 用户在做 AI 项目
```

## 💡 最佳实践

### 1. 用户信息管理

```python
# 设置用户基本信息
voice_prompt.set_user_info(
    name="小明",
    preferences={
        "hobby": "攀岩",
        "language": "中文"
    },
    context={
        "location": "北京",
        "time_zone": "Asia/Shanghai"
    }
)
```

### 2. 知识库管理

```python
# 添加分类知识
voice_prompt.add_knowledge("用户喜欢攀岩", category="兴趣")
voice_prompt.add_knowledge("用户是程序员", category="职业")
voice_prompt.add_knowledge("用户在北京", category="位置")
```

### 3. 对话历史

- 自动保存最近 10 轮对话
- 超过限制自动清理旧对话
- 可手动清空：`/clear`

## 🎯 效果对比

### 之前（无 Prompt 控制）

```
你: 推荐攀岩鞋
AI: 当然！以下是几个推荐：
### 1. **La Sportiva**
- **特点**：专业性强
- **推荐型号**：
  - **Tarantulace**：适合初学者
  - **Miura**：适合进阶
### 2. **Scarpa**
...（长篇大论）
```

### 现在（有 Prompt 控制）

```
你: 推荐攀岩鞋
AI: 我推荐 La Sportiva 的 Tarantulace，特别适合初学者，舒适又不贵。你是刚开始玩攀岩吗？

你: 是的
AI: 那这双很合适！建议去实体店试穿，攀岩鞋要比平时小半码。需要我告诉你哪里能买吗？
```

**完全自然流畅！**

## 🚀 立即体验

```bash
python src/main.py
```

试试这些对话：

```
你: /setname 小明
你: /addknowledge 我喜欢户外运动
你: 你好
你: 推荐一个周末活动
你: 今天天气怎么样
```

AI 会：
- 记住你的名字
- 根据知识库个性化回答
- 保持简洁口语化
- 不输出任何格式符号
- 实时语音播放

完美的语音助手体验！🎉
