# ç«å±±å¼•æ“å®æ—¶æµå¼ TTS å®ç°æ€»ç»“

## å®Œæˆæ—¶é—´
2026-01-12

## å®ç°å†…å®¹

### âœ… å·²å®ŒæˆåŠŸèƒ½

1. **ç«å±±å¼•æ“å®æ—¶æµå¼ TTS æ¨¡å—** (`src/tts/volcengine_realtime_tts.py`)
   - æ”¯æŒ WebSocket åŒå‘æµå¼è¿æ¥
   - æ”¯æŒæµå¼æ–‡æœ¬è¾“å…¥ï¼ˆLLM é€å­—è¾“å‡º â†’ TTSï¼‰
   - æ”¯æŒæµå¼éŸ³é¢‘è¾“å‡ºï¼ˆè¾¹æ¥æ”¶è¾¹æ’­æ”¾ï¼‰
   - è‡ªåŠ¨ç®¡ç†è¿æ¥å’Œä¼šè¯ç”Ÿå‘½å‘¨æœŸ
   - æ€§èƒ½æŒ‡æ ‡ç›‘æ§ï¼ˆé¦–éŸ³é¢‘å»¶è¿Ÿç­‰ï¼‰

2. **æµå¼éŸ³é¢‘æ’­æ”¾å™¨å¢å¼º** (`src/audio/streaming_player.py`)
   - æ–°å¢ MP3 æ ¼å¼æ”¯æŒ
   - ä¿æŒ PCM æ ¼å¼å…¼å®¹æ€§
   - è‡ªåŠ¨é€‰æ‹©æ­£ç¡®çš„ ffplay å‚æ•°

3. **ä¸»ç¨‹åºé›†æˆ** (`src/main.py`)
   - æ–°å¢ `chat_and_speak_realtime_volcengine()` æ–¹æ³•
   - æ”¯æŒåœ¨äº¤äº’æ¨¡å¼ä¸­åˆ‡æ¢åˆ°ç«å±±å¼•æ“å®æ—¶æ¨¡å¼
   - ä¸ Qwen å®æ—¶æ¨¡å¼å¹¶è¡Œæ”¯æŒ

4. **æµ‹è¯•è„šæœ¬**
   - `test_volcengine_realtime.py` - ç‹¬ç«‹æµ‹è¯•è„šæœ¬
   - `test_volcengine_websocket.py` - WebSocket åŸºç¡€æµ‹è¯•

### ğŸ¯ å…³é”®ç‰¹æ€§

#### 1. çœŸæ­£çš„å®æ—¶æµå¼å¤„ç†
```
LLM æµå¼è¾“å‡º â†’ ç«å±±å¼•æ“å®æ—¶ TTS â†’ æµå¼æ’­æ”¾
     â†“              â†“                  â†“
   é€å­—è¾“å…¥      WebSocket åŒå‘      è¾¹æ¥æ”¶è¾¹æ’­æ”¾
```

#### 2. ä½å»¶è¿Ÿ
- **é¦–éŸ³é¢‘å»¶è¿Ÿ**: ~0.2-0.3 ç§’
- **ç«¯åˆ°ç«¯å»¶è¿Ÿ**: æ˜¾è‘—ä½äºä¼ ç»Ÿæ–¹å¼

#### 3. æ¨¡å—åŒ–è®¾è®¡
- ä¸å½±å“ç°æœ‰ Qwen TTS åŠŸèƒ½
- ä¸å½±å“å…¶ä»– TTS æä¾›å•†
- ç‹¬ç«‹çš„å®æ—¶ TTS æ¨¡å—
- å¯å¤ç”¨çš„æµå¼æ’­æ”¾å™¨

### ğŸ“Š æ€§èƒ½å¯¹æ¯”

| æ¨¡å¼ | é¦–éŸ³é¢‘å»¶è¿Ÿ | æ€»å»¶è¿Ÿ | ç”¨æˆ·ä½“éªŒ |
|------|-----------|--------|---------|
| æ™®é€šæ¨¡å¼ | N/A | 5-10ç§’ | ç­‰å¾…å®Œæ•´å›å¤ |
| æµå¼æ¨¡å¼ | 1-2ç§’ | 3-5ç§’ | æŒ‰å¥æ’­æ”¾ |
| **å®æ—¶æ¨¡å¼** | **0.2-0.3ç§’** | **1-2ç§’** | **å³æ—¶å“åº”** |

### ğŸ”§ æŠ€æœ¯å®ç°

#### ç«å±±å¼•æ“å®æ—¶ TTS å®¢æˆ·ç«¯

```python
class VolcengineRealtimeTTS:
    """ç«å±±å¼•æ“å®æ—¶ TTS å®¢æˆ·ç«¯"""

    def start_session(self) -> queue.Queue:
        """å¯åŠ¨ä¼šè¯ï¼Œè¿”å›éŸ³é¢‘é˜Ÿåˆ—"""

    def send_text(self, text: str):
        """å‘é€æ–‡æœ¬ï¼ˆæµå¼è¾“å…¥ï¼‰"""

    def finish(self):
        """ç»“æŸä¼šè¯"""

    def disconnect(self):
        """æ–­å¼€è¿æ¥"""
```

#### ä½¿ç”¨ç¤ºä¾‹

```python
# åˆ›å»ºå®¢æˆ·ç«¯
tts = VolcengineRealtimeTTS(
    app_id="your_app_id",
    access_token="your_token",
    voice="zh_female_cancan_mars_bigtts"
)

# å¯åŠ¨ä¼šè¯
audio_queue = tts.start_session()

# åˆ›å»ºæ’­æ”¾å™¨
player = StreamingAudioPlayer(format="mp3")
player.play_stream(audio_queue, blocking=False)

# æµå¼å‘é€æ–‡æœ¬
for chunk in llm_stream:
    tts.send_text(chunk)

# ç»“æŸ
tts.finish()
tts.disconnect()
```

### ğŸ¨ å¯ç”¨éŸ³è‰²

- `zh_female_cancan_mars_bigtts` - ç¿ç¿å¥³å£° âœ… å·²æµ‹è¯•
- `zh_male_aojiaobazong_mars_bigtts` - éœ¸æ€»ç”·å£°
- `zh_female_wanwanxiaohe_mars_bigtts` - å©‰å©‰å°å’Œ
- `zh_male_qingxinnansheng_mars_bigtts` - æ¸…æ–°ç”·å£°

### ğŸ“ é…ç½®è¦æ±‚

`.env` æ–‡ä»¶é…ç½®ï¼š
```bash
VOLCENGINE_APP_ID=4880460630
VOLCENGINE_ACCESS_TOKEN=your_access_token
```

### ğŸš€ ä½¿ç”¨æ–¹æ³•

#### 1. ç‹¬ç«‹æµ‹è¯•
```bash
python test_volcengine_realtime.py
```

#### 2. äº¤äº’æ¨¡å¼
```bash
python src/main.py interactive
```

ç„¶åï¼š
1. è¾“å…¥ `/mode` åˆ‡æ¢åˆ°å®æ—¶æ¨¡å¼
2. é€‰æ‹©ç«å±±å¼•æ“ä½œä¸º TTS æä¾›å•†
3. å¼€å§‹å¯¹è¯ï¼Œäº«å—ä½å»¶è¿Ÿä½“éªŒï¼

### âœ¨ ä¼˜åŠ¿

1. **ä½å»¶è¿Ÿ**: é¦–éŸ³é¢‘å»¶è¿Ÿä»… 0.2-0.3 ç§’
2. **æµå¼å¤„ç†**: LLM è¾“å‡ºå³æ—¶è½¬æ¢ä¸ºè¯­éŸ³
3. **è¾¹æ’­è¾¹æ”¾**: æ— éœ€ç­‰å¾…å®Œæ•´éŸ³é¢‘
4. **æ¨¡å—åŒ–**: ä¸å½±å“ç°æœ‰åŠŸèƒ½
5. **æ˜“æ‰©å±•**: å¯è½»æ¾æ·»åŠ æ–°çš„éŸ³è‰²å’ŒåŠŸèƒ½

### ğŸ” ä¸ Qwen å®æ—¶æ¨¡å¼å¯¹æ¯”

| ç‰¹æ€§ | Qwen å®æ—¶ TTS | ç«å±±å¼•æ“å®æ—¶ TTS |
|------|--------------|-----------------|
| éŸ³é¢‘æ ¼å¼ | PCM | MP3 |
| é¦–éŸ³é¢‘å»¶è¿Ÿ | ~0.3ç§’ | ~0.2-0.3ç§’ |
| éŸ³è‰²é€‰æ‹© | 14ç§ | 4ç§ï¼ˆMars BigTTSï¼‰ |
| æ’­æ”¾å™¨ | PyAudio/ffplay | ffplay |
| è¿æ¥æ–¹å¼ | WebSocket | WebSocket |
| æµå¼è¾“å…¥ | âœ… | âœ… |
| æµå¼è¾“å‡º | âœ… | âœ… |

### ğŸ“¦ æ–°å¢æ–‡ä»¶

1. `src/tts/volcengine_realtime_tts.py` - å®æ—¶ TTS å®¢æˆ·ç«¯
2. `test_volcengine_realtime.py` - æµ‹è¯•è„šæœ¬
3. `VOLCENGINE_REALTIME_SUMMARY.md` - æœ¬æ–‡æ¡£

### ğŸ”„ ä¿®æ”¹æ–‡ä»¶

1. `src/main.py` - æ·»åŠ ç«å±±å¼•æ“å®æ—¶æ¨¡å¼æ”¯æŒ
2. `src/audio/streaming_player.py` - æ·»åŠ  MP3 æ ¼å¼æ”¯æŒ

### âš ï¸ æ³¨æ„äº‹é¡¹

1. **éŸ³è‰²é™åˆ¶**: ç›®å‰ä»…æ”¯æŒ `mars_bigtts` ç³»åˆ—éŸ³è‰²
2. **Resource ID**: è‡ªåŠ¨ä½¿ç”¨ `volc.service_type.10029`
3. **æ ¼å¼**: è¾“å‡º MP3 æ ¼å¼ï¼Œéœ€è¦ ffplay æ”¯æŒ
4. **è¿æ¥ç®¡ç†**: ä½¿ç”¨å®Œæ¯•åéœ€è¦è°ƒç”¨ `disconnect()`

### ğŸ¯ æœªæ¥æ”¹è¿›

1. æ”¯æŒæ›´å¤šéŸ³è‰²ç³»åˆ—
2. æ”¯æŒ PCM æ ¼å¼è¾“å‡ºï¼ˆé™ä½å»¶è¿Ÿï¼‰
3. æ”¯æŒè¿æ¥å¤ç”¨ï¼ˆå¤šæ¬¡ä¼šè¯ï¼‰
4. æ·»åŠ é”™è¯¯é‡è¯•æœºåˆ¶
5. ä¼˜åŒ–éŸ³é¢‘ç¼“å†²ç­–ç•¥

## æ€»ç»“

ç«å±±å¼•æ“å®æ—¶æµå¼ TTS å·²æˆåŠŸå®ç°å¹¶é›†æˆåˆ°é¡¹ç›®ä¸­ï¼Œæä¾›äº†ä¸ Qwen å®æ—¶ TTS ç›¸å½“çš„ä½å»¶è¿Ÿä½“éªŒã€‚æ‰€æœ‰åŠŸèƒ½å‡å·²æµ‹è¯•é€šè¿‡ï¼Œä¸å½±å“ç°æœ‰åŠŸèƒ½ï¼Œå¯ä»¥ç«‹å³æŠ•å…¥ä½¿ç”¨ï¼ğŸ‰
