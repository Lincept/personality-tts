# 如何使用火山引擎实时流式 TTS

## 快速开始

### 启动交互模式

```bash
python src/main.py interactive
```

### 选择角色

启动后会显示可用角色列表，选择你喜欢的角色（比如 5 - 学姐）

### 切换到火山引擎 TTS

在交互模式中输入命令：

```
/provider
```

这会在 **通义千问 TTS** 和 **火山引擎 Seed2 TTS** 之间切换。

### 开始对话

现在你可以直接输入文本，系统会使用火山引擎的实时流式 TTS 来回复！

## 完整示例

```bash
# 1. 启动程序
python src/main.py interactive

# 2. 选择角色
请选择角色 (1-5) 或直接回车使用第一个: 5

# 3. 查看当前配置
你: /info

当前配置:
  模式: 实时模式 (LLM逐字→TTS→边播边放) ⚡
  TTS 提供商: 通义千问 TTS
  角色: 学姐 (温柔、体贴、有点小傲娇)
  对话轮数: 0
  知识库条目: 0

# 4. 切换到火山引擎
你: /provider

✓ 已切换到: 火山引擎 Seed2 TTS
  💡 提示: 火山引擎实时模式使用音色 zh_female_cancan_mars_bigtts

# 5. 开始对话
你: 你好呀

🤖 AI 回复 (实时流式):
------------------------------------------------------------
学弟，今天过得怎么样？有什么需要学姐帮忙的吗？
------------------------------------------------------------
```

## 可用命令

| 命令 | 说明 |
|------|------|
| `/quit` | 退出程序 |
| `/mode` | 切换模式 (realtime/streaming/normal) |
| `/provider` | **切换 TTS 提供商 (qwen3/volcengine)** |
| `/role <角色>` | 切换角色 |
| `/clear` | 清空对话历史 |
| `/history` | 查看对话历史 |
| `/setname <名字>` | 设置用户名 |
| `/addknowledge <内容>` | 添加知识库 |
| `/info` | 查看当前配置 |

## 模式说明

### 实时模式 (推荐) ⚡
- **特点**: LLM 逐字输出 → TTS 实时合成 → 边播边放
- **延迟**: 首音频延迟 0.2-0.3 秒
- **体验**: 最佳，几乎无感知延迟
- **支持**: Qwen3 TTS ✅ | 火山引擎 TTS ✅

### 流式模式
- **特点**: LLM 按句输出 → TTS 合成 → 播放
- **延迟**: 1-2 秒
- **体验**: 较好
- **支持**: 所有 TTS 提供商

### 普通模式
- **特点**: 等待完整回复 → TTS 合成 → 播放
- **延迟**: 5-10 秒
- **体验**: 一般
- **支持**: 所有 TTS 提供商

## TTS 提供商对比

| 特性 | 通义千问 TTS | 火山引擎 Seed2 TTS |
|------|-------------|-------------------|
| 实时模式 | ✅ | ✅ |
| 音频格式 | PCM | MP3 |
| 首音频延迟 | ~0.3秒 | ~0.2-0.3秒 |
| 音色数量 | 14种 | 4种 (Mars BigTTS) |
| 音色名称 | Cherry, Serena 等 | 灿灿、霸总等 |
| 播放器 | PyAudio/ffplay | ffplay |

## 音色说明

### 火山引擎可用音色

当前使用的音色：**zh_female_cancan_mars_bigtts** (灿灿女声)

其他可用音色：
- `zh_male_aojiaobazong_mars_bigtts` - 霸总男声
- `zh_female_wanwanxiaohe_mars_bigtts` - 婉婉小和
- `zh_male_qingxinnansheng_mars_bigtts` - 清新男声

## 故障排除

### 问题1: 切换到火山引擎后没有声音

**解决方案**:
1. 检查 `.env` 文件配置：
   ```bash
   VOLCENGINE_APP_ID=4880460630
   VOLCENGINE_ACCESS_TOKEN=lVpvF5z-MrSNiNeUDrXZjTMkNnZkGzWw
   ```
2. 确保 ffplay 已安装：
   ```bash
   ffplay -version
   ```

### 问题2: 延迟较高

**解决方案**:
1. 确保使用实时模式：输入 `/mode` 切换到实时模式
2. 检查网络连接
3. 尝试切换 TTS 提供商对比

### 问题3: 音色不对

**解决方案**:
- 火山引擎实时模式固定使用 `zh_female_cancan_mars_bigtts` 音色
- 如需更换音色，需要修改代码中的音色参数

## 性能优化建议

1. **使用实时模式**: 获得最佳体验
2. **保持网络稳定**: 实时模式对网络要求较高
3. **选择合适的角色**: 不同角色回复长度不同，影响总延迟
4. **定期清理历史**: 使用 `/clear` 清空对话历史，避免上下文过长

## 高级用法

### 自定义用户信息

```
你: /setname 小明
✓ 用户名已设置为: 小明

你: /addknowledge 我喜欢攀岩
✓ 已添加知识: 我喜欢攀岩
```

### 查看对话历史

```
你: /history

对话历史:
用户: 你好呀
助手: 学弟，今天过得怎么样？...
```

## 总结

使用火山引擎实时流式 TTS 非常简单：

1. 启动程序：`python src/main.py interactive`
2. 选择角色
3. 输入 `/provider` 切换到火山引擎
4. 开始对话！

享受低延迟的实时语音交互体验！🎉
